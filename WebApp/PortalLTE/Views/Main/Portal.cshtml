@using System.Data
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>@ViewBag.Title</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
          name="viewport">
    <!--miniui-->
    <script>var IsUseNewPortal = '@ViewBag.IsUseNewPortal';var NoPopupLayer = '@ViewBag.NoPopupLayer'; var PortalKeys = '@ViewBag.PortalKeys';var userInfo = '@ViewBag.User.UserID';var PortalNewsTime = @ViewBag.PortalNewsTime; </script>
    <script type="text/javascript" language="JScript" src="/CommonWebResource/CoreLib/Combine/SimplePageInc.js"></script>
    <!-- LOGO -->
    <link rel="Shortcut Icon" href="/PortalLTE/Images/favicon.ico" />
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="/PortalLTE/Scripts/bootstrap/css/bootstrap.min.css">
    <!-- FontAwesome 4.3.0 -->
    <link href="/PortalLTE/Scripts/dist/css/font-awesome.min.css?main=1" rel="stylesheet"
          type="text/css" />
    <!-- Ionicons 2.0.0 -->
    <link href="/PortalLTE/Scripts/dist/css/ionicons.min.css" rel="stylesheet" type="text/css" />
    <script src="/PortalLTE/Scripts/jQuery/jQuery-2.2.0.min.js"></script>
    <script src="/PortalLTE/Scripts/dist/js/vue.min.js"></script>

    <!-- Theme style -->
    <link rel="stylesheet" href="/PortalLTE/Scripts/dist/css/AdminLTE.min.css">
    <script src="/CommonWebResource/Theme/Default/MiniCssInc.js" type="text/javascript"></script>
    <script>
        Vue.filter('date', function (input) {
            var date = new Date(input);
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var day = date.getDate();
            month = month < 10 ? "0" + month : month;
            day = day < 10 ? "0" + day : day;
            var hour = date.getHours();
            hour = hour < 10 ? "0" + hour : hour;
            var minute = date.getMinutes();
            minute = minute < 10 ? "0" + minute : minute;
            return year.toString().substr(2, 2) + "-" + month + "-" + day + " " + hour + ":" + minute;
        });
        var LGID = "@Html.Raw(ViewBag.LGID)";
        @Html.Raw(ViewBag.NoLoginPortalDic);
    </script>
    <script>
        $(function () {//禁止退格键后退

            $(document).ready(function () {
                //处理默认背景图片
                var bg = get("background-image");
                if (bg == null)
                    bg = "/PortalLTE/Images/default.jpg";
                $("body").css("background-image", "url(" + bg + ")");
            });

            //处理键盘事件 禁止后退键（Backspace）密码或单行、多行文本框除外
            function banBackSpace(e) {
                var ev = e || window.event; //获取event对象
                var obj = ev.target || ev.srcElement; //获取事件源

                var t = obj.type || obj.getAttribute('type'); //获取事件源类型

                //获取作为判断条件的事件类型
                var vReadOnly = obj.getAttribute('readonly');
                var vEnabled = obj.getAttribute('enabled');
                //处理null值情况
                vReadOnly = (vReadOnly == null) ? false : vReadOnly;
                vEnabled = (vEnabled == null) ? true : vEnabled;

                //当敲Backspace键时，事件源类型为密码或单行、多行文本的，
                //并且readonly属性为true或enabled属性为false的，则退格键失效
                var flag1 = (ev.keyCode == 8 && (t == "password" || t == "text" || t == "textarea")
                    && (vReadOnly == true || vEnabled != true)) ? true : false;

                //当敲Backspace键时，事件源类型非密码或单行、多行文本的，则退格键失效
                var flag2 = (ev.keyCode == 8 && t != "password" && t != "text" && t != "textarea")
                    ? true : false;

                //禁止TAB键
                var flag3 =  (ev.keyCode == 9 && t != "password" && t != "text" && t != "textarea") ? true : false;
                //判断
                if (flag2) {
                    return false;
                }
                if (flag1) {
                    return false;
                }
                if (flag3) {
                    return false;
                }
            }

            //禁止后退键 作用于Firefox、Opera
            document.onkeypress = banBackSpace;
            //禁止后退键 作用于IE、Chrome
            document.onkeydown = banBackSpace;

        });
    </script>
    <style>
        body {
            height: 100%;
            overflow: hidden;
            font-family: '微软雅黑','Helvetica Neue',Helvetica,Arial,sans-serif;
            /*background-image: url('/PortalLTE/Images/bg.jpg');*/
            background-size: cover;
            background-position-x: 50%;
            background-position-y: 0%;
            background-size: cover;
            background-repeat-x: no-repeat;
            background-repeat-y: no-repeat;
        }

        .mini-window .mini-panel-header {
            background-image: none;
            background-color: #3c8dbc;
        }

        .login-tab {
            color: #898989;
            text-align: right;
            font-size: 14px;
            margin-top: 15px;
        }

        .login-tab-en {
            background-color: rgba(0,0,0,.1);
            font-size: 13px;
            line-height: 24px;
            height: 24px;
            border-radius: 5px;
            padding: 0 10px 0 5px;
            width: 76px;
            position: absolute;
            right: 28px;
            top: 17px;
            font-weight: 100;
        }

            .login-tab-en input {
                position: relative;
                top: 2px;
            }

        .connectedSortable {
            min-height: 10px;
        }
 
    </style>
</head>
<body class="hold-transition skin-blue sidebar-mini has-subMenu" style="min-width: 1024px;" id="newPortal" v-cloak>
    <div class="shortcutmenu" style="display: none">
        <ul id="ulShortcut"></ul>
    </div>
    <div class="wrapper" v-cloak>
        <header class="main-header">
            <!-- Logo -->
            <a onclick="gohome()" class="logo" id="logo" style="cursor: pointer">
                <!-- mini logo for sidebar mini 50x50 pixels -->
                <span class="logo-mini"><b>A</b>LT</span>
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg"></span>
            </a>
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top">
                <!-- Sidebar toggle button-->
                <div id="copyright"></div>
                <a href="#" id="sidebar-toggle" class="sidebar-toggle" data-toggle="offcanvas" role="button" onclick="openMenu()"><span class="sr-only">Toggle navigation</span> </a>
                <a href="#" class="navigationbar-toggle" style="line-height:53px;width:20px;font-size:11px" role="button" onclick="navigationbar()"><i class="glyphicon glyphicon-th-large"></i> </a>
                <a class="menu_prev" onmouseover="onMouseOverMenu(1)" style="cursor:pointer" onmouseout="onMouseOutMenu(1)"><img id="prevImg" src="/PortalLTE/Images/bt-left.png" /></a>
                <ul id="one-menu">
                    <ul id="two-menu">
                        @foreach (DataRow item in ViewBag.TopMenu)
                        {
                             <li id="@item["ID"].ToString()" onclick="ShowMenuOrPage('@item["ID"].ToString()','@item["Url"].ToString()', '@item["Name"].ToString()','@item["Name"].ToString()','@item["Description"].ToString()', this)">@item["Name"].ToString()</li>
                        }
                    </ul>
                </ul>
                <a class="menu_next" onmouseover="onMouseOverMenu(2)" style="cursor:pointer" onmouseout="onMouseOutMenu(2)"><img id="nextImg" src="/PortalLTE/Images/bt-right.png" /></a>
                <div class="navbar-custom-menu">
                     @if (ViewBag.User.UserID != null)
                     {
                        <ul class="nav navbar-nav">
                            <!--Refresh-->
                            <li class="dropdown messages-menu" title="首页">
                                <a href="#" class="dropdown-toggle" onclick="javascript:location.reload(true);"><i class="fa fa-home" style="font-size: 15px;"></i></a>
                            </li>
                            <!-- Messages: style can be found in dropdown.less-->
                            <li class="dropdown messages-menu" title="消息">
                                <a href="#" class="dropdown-toggle" onclick="openMsg();"><i class="fa fa-envelope-o"></i><span class="label label-success" id="MsgCount"></span></a>
                            </li>
                            <!-- Notifications: style can be found in dropdown.less -->
                            <li class="dropdown notifications-menu" title="提醒">
                                <a href="#" class="dropdown-toggle" onclick="openAlarm();">
                                    <i class="fa fa-bell-o"></i><span class="label label-warning" id="AlarmCount"></span>
                                </a>
                            </li>
                            <!-- Tasks: style can be found in dropdown.less -->
                            <li class="dropdown tasks-menu" title="任务">
                                <a href="#" class="dropdown-toggle" onclick="openTask();">
                                    <i class="fa fa-flag-o"></i>
                                    <span class="label label-danger" id="TaskCount"></span>
                                </a>
                            </li>
                            <!-- Favorite: style can be found in dropdown.less -->
                            <li class="dropdown favorite-menu">
                                <a href="#" class="dropdown-toggle"><i class="fa fa-star-o" id="imgShortcut" style="font-size: 15px;" title="快捷入口"></i></a>
                            </li>
                            <!-- User Account: style can be found in dropdown.less -->
                            <li class="dropdown user user-menu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <img src="/PortalLTE/Main/UserImage" class="user-image" alt="User Image">
                                </a>
                                <ul class="dropdown-menu" style="box-shadow: 1px 1px 7px 0px #999;">
                                    <!-- User image -->
                                    <li class="user-header">
                                        <img src="/PortalLTE/Main/UserImage" class="img-circle" alt="User Image">
                                        <p style="color: #FFD400">
                                            @ViewBag.User.UserName <small>@ViewBag.User.UserOrgName</small>
                                        </p>
                                    </li>

                                    <!-- Menu Footer-->
                                    <li class="user-footer">
                                        <div style="float: left;">
                                            <a href="#" class="btn btn-default btn-flat">取消</a>
                                        </div>
                                        <div style="float: left; text-align: center; margin-left: 20px;">
                                            <a href="#" class="btn btn-default btn-flat" onclick="openUIF();">个人信息维护</a>
                                        </div>
                                        <div style="float: right;">
                                            <a href="#" class="btn btn-default btn-flat" onclick="doLogout();">退出</a>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                            <!-- Control Sidebar Toggle Button -->
                            <li>
                                <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
                            </li>
                        </ul>
                     }
                     else
                     {
                        <ul class="nav navbar-nav">
                            <!-- User Account: style can be found in dropdown.less -->
                            <li class="dropdown user user-menu" style="width:115px;">
                                <div onclick="openLoginWindow()" class="login-user" style="display:none;" data-toggle="dropdown">
                                    <img src="~/Images/user.png"  class="user-image" alt="User Image"/>系统登录
                                </div>
                               
                            </li>
                        </ul>
                     }
                </div>
            </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">
            <!-- sidebar: style can be found in sidebar.less -->
            @if (ViewBag.User.UserID != null)
            {
                <section class="sidebar">
                    <!-- Sidebar user panel -->
                    <div class="user-panel">
                        <div class="pull-left image">
                            <img src="/PortalLTE/Main/UserImage" class="img-circle" alt="头像" />
                        </div>
                        <div class="pull-left info">
                            <p>
                                @ViewBag.User.UserName
                                &nbsp;@ViewBag.User.WorkNo
                            </p>
                            <a href="#"><i class="fa fa-circle text-success"></i>Online</a>
                        </div>
                    </div>
                    <!-- sidebar menu: : style can be found in sidebar.less -->
                    <div class="nicescroll" style="position: absolute; top: 10px; bottom: 0; left: 0; right: 0;">
                        <ul class="sidebar-menu" id="sidebar-menu"></ul>
                    </div>
                </section>
            }
            <!-- /.sidebar -->
        </aside>
        <div class="main-content  nicescroll" id="mainView">
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper" style="overflow:hidden;">
                <!-- Main content -->
                     @if (ViewBag.User.UserID == null)
                     {
                        <div class="main-div-bg" style="top: 0px;">
	                        <div class="homebanner">
		                        <ul>
			                        <li class="Load" style="z-index:99" v-for="banner in bannerList">
				                        <img :src="banner.Name" alt="">
			                        </li>
		                        </ul>
		                        <div class="homeleft"><</div>
		                        <div class="homeright">></div>
		                        <div class="homedot" style="display:none;">
                                    <a href="javascript:;" v-for="item in bannerList"></a>
                                </div>
	                        </div>
                        </div>
                     }
                <div :class="indexClass" id="index-main-list">
                   
                     @if (ViewBag.User.UserID != null)
                     {
                        <div class="shortcut" hidden>
                            <div class="center" :style="portalStyle">
                                <ul class="shortcurlist">
                                    <li v-for="cur in curPortalList" :id="cur.TempletID" :onclick="cur.Click">
                                        <div>
                                            <img :class="cur.Check ? 'selection' : ''" style="height:68px;" :src="cur.Src" />
                                        </div>
                                        <div>{{cur.Title}}</div>  
                                    </li>
                                </ul>
                            </div>
                        </div>
                     }
                     else
                     {
                       <div class="nologin-left"></div>
                       <div class="nologin" v-cloak>
                            @Html.Raw(ViewBag.NoLoginPortalLTE)
                        </div>            
                        <div class="nologin-right">
                        </div>
                        <div class="right_navigation" id="noLoginNavigation" v-cloak>
                             <ul>
                                  <li v-for="item in NoLoginList" :id="item.ID" :onclick="item.Click" onmouseover="onMouseOverPortal(this, 0)" onmouseout="onMouseOverPortal(this, 1)"><hr /><label>{{item.Title}}</label></li>
                             </ul>
                        </div>  
                     }
                <div class="shortcut_thumbnail" hidden></div>
                    @if (ViewBag.User.UserID != null)
                    {
                        @Html.Raw(ViewBag.PortalLTE)
                    }
                </div>       
            
                </div>
                <!-- /.content -->
            </div>
        </div>

        <div class="main-content " id="iframe">
            <div class="content-wrapper">
                <ul class="custab list-unstyled clearfix" id="custab"></ul>
                <ul class="custab-content list-unstyled clearfix" id="custab-content"></ul>
                <ul class="Subsystem-bg custab-content list-unstyled clearfix" id="custab-content-menu" style="display:none;">
                    <li>
                        <div class="base" id="_menuExplain">
	                    <div class="up">
	                       <div class="up_left">
		                      <div class="circle"><img src="/PortalLTE/Images/circle_img_1.png"/></div>
		                      <div  class="up_left_line">
	
		                       </div>
		                    </div>
		                     <div class="up_middle">
			                    <div class="up_middle_1">{{EName}}</div> 
			                    <div class="up_middle_2">{{Name}}</div> 		 
		                    </div>
		                     <div class="up_right">
		                    <div class="up_right_font">系统</div>
		
		                    </div>
			                    </div>
		                    <div class="down">
			                    <div class="down_nr"><div class="down_content nicescroll">{{Explain}}</div></div>
	                    </div>
                    </div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="main-content " id="pageItem">
            <div class="pageItem-content">
                <div class="pageItem-body">
                    <div id="pageItemText">
                    </div>
                </div>
            </div>
        </div>
        <!-- /.content-wrapper -->
        <footer class="main-footer" style="display: none">
            <div class="pull-right hidden-xs">
                Version 2.3.3
            </div>
            Copyright Goodwaysoft Ltd. All rights reserved.
        </footer>
        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Create the tabs -->
            <ul class="nav nav-tabs nav-justified control-sidebar-tabs" style="display: none">
                <li>
                    <a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a>
                </li>
            </ul>
            <!-- Tab panes -->
            <div class="tab-content nicescroll" style="height: 100%; position: relative">
                <!-- Home tab content -->
                <div class="tab-pane" id="control-sidebar-home-tab">
                </div>
                <!-- /.tab-pane -->
                <!-- Stats tab content -->
                <div class="tab-pane" id="control-sidebar-stats-tab">
                    Stats Tab Content
                </div>
                <!-- /.tab-pane -->
            </div>
        </aside>
        <!-- /.control-sidebar -->
        <!-- Add the sidebar's background. This div must be placed
             immediately after the control sidebar -->
        <div class="control-sidebar-bg">
        </div>
    </div>

<div id="loginWindow" class="login-window" >
    <div class="login-close" onclick="closeLoginWindow()"><img src="/PortalLTE/Images/loginclose.png" /></div>
    <div style="margin-left:25px;margin-right:25px;margin-bottom:25px">
        <div>
             <input class="login-username-input" id="loginName" type="text" placeholder="{{loginWindowInfo.Title}}" onkeydown="return EnterKeyDown(event)" />
        </div>
        <div>
             <input class="login-userpassword-input" id="password" type="password" placeholder="{{loginWindowInfo.Password}}" onkeydown="return EnterKeyDown(event)" />
        </div>
        
        <div style="height:40px;line-height:40px;" class="login-password">
            <div class="checkBox" style="text-align: left; float: left;">
                   <input id="rememberUserAndPwd" style="cursor:pointer;position: relative;top: 3px;font-size:12px;" type="checkbox" />&nbsp;<label style="cursor:pointer;" for="rememberUserAndPwd">
                         {{loginWindowInfo.Remember}}
                        </label>
             </div>
             <a style="font-size:12px; cursor:pointer;float: right" onclick="lostpassword()">{{loginWindowInfo.Modify}}</a>
        </div>
        <div style="text-align:center;">
                <button type="button" id="btnLogin" class="login-button" onclick="login()">
                    {{loginWindowInfo.Button}}
                </button>
        </div>
        @if (System.Configuration.ConfigurationManager.AppSettings["IsUseMultilingual"] == "True")
        {
        <div class="login-language" onclick="switchLanguage()">
             {{loginWindowInfo.Language}}
        </div>
        }
    </div>
</div>

<div id="forgetWindow" class="mini-window" title="修改密码" style="width: 320px;position: fixed; z-index: 999; display:none;" showmodal="true" allowresize="false" allowdrag="true">
    <div style="margin-left:25px;margin-right:25px;">
        <div>
             <input class="login-name-input" id="forgetLoginName" type="text" placeholder="用户名"/>
        </div>
        <div>
             <input class="login-password-input" id="oldPwd" type="password" placeholder="原密码"/>
        </div>
        <div>
             <input class="login-password-input" id="newPwd" type="password" placeholder="新密码" />
        </div>      
        <div>
             <input class="login-password-input" id="newPwdOk" type="password" placeholder="确认新密码" />
        </div>             
        <div style="height:80px;margin-top: 8px;">
                <button type="button" id="btnForgetSave" class="login-button" style="width:calc(50% - 5px);" onclick="changePwd()">
                    保&nbsp;&nbsp;&nbsp;存
                </button>
                <button type="button" id="btForgetReset" class="login-button" style="width:calc(50% - 5px);float:right;" onclick="reset()">
                    重&nbsp;&nbsp;&nbsp;置
                </button>
        </div>
    </div>
</div>

    <!-- ./wrapper -->
    <!-- jQuery UI 1.11.4 -->
    <script src="/PortalLTE/Scripts/jQueryUI/jquery-ui.min.js"></script>
    <script src="/PortalLTE/Scripts/jQuery/jquery.nicescroll.min.js"></script>
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <script>
        $.widget.bridge('uibutton', $.ui.button);
    </script>
    <!-- Bootstrap 3.3.6 -->
    <script src="/PortalLTE/Scripts/bootstrap/js/bootstrap.min.js"></script>
    <!-- AdminLTE App -->
    <script src="/PortalLTE/Scripts/dist/js/app.min.js"></script>
    <script src="/PortalLTE/Scripts/dist/js/demo.js" charset="utf-8"></script>
    <script src="/PortalLTE/Scripts/dist/js/pages/dashboard.js"></script>
    <!--miniui-->
    <script src="/CommonWebResource/CoreLib/MiniUI/miniui.js" type="text/javascript"></script>
    <script type="text/javascript">  
        var alertTitleStr = "@Html.Raw(ViewBag.Title)";
    </script>
    <script type="text/javascript">
        var topH = 51;
        function CheckIsMobile() {
            var browser = {
                versions: function () {
                    var u = navigator.userAgent, app = navigator.appVersion;
                    return { //移动终端浏览器版本信息
                        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
                        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
                        iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
                        iPad: u.indexOf('iPad') > -1, //是否iPad
                    };
                }(),
            }
            if (browser.versions.iPhone || browser.versions.iPad || browser.versions.android)
                return true;

            return false;
        }
        //if (!CheckIsMobile()) {
        //    var f = getFlashVersion();
        //    if (f < 0) {
        //        openWindow("/PortalLTE/OpenFlash/HowToDo.htm", "检测到当前浏览器未启用Flash", "80%", "80%");
        //    }
        //}
        
        function changePwd() {
            var e_oldPwd = Encrypt($("#oldPwd").val());
            var e_newPwd = Encrypt($("#newPwd").val());
            var e_newPwdOk = Encrypt($("#newPwdOk").val());

            function store(name, val) {
                setCache(name, val);
            }
            function get(name) {
                return getCache(name);
            }

            $.ajax({
                url: "ChangePwd",
                data: { loginName: $("#forgetLoginName").val(), oldPwd: e_oldPwd, newPwd: e_newPwd, newPwdOk: e_newPwdOk },
                type: "post",
                dataType: "json",
                success: function (data) {
                    //增加新版报错分支
                    if (data.errcode) {
                        var msg = getErrorFromHtml(data.errmsg);
                        msgUI(msg, 4);
                        return;
                    }
                    alert("密码修改成功！");
                    location.href = "/portallte/main/login";
                    store("password", "");
                },
                error: function (xhr, textStatus, errorThrown) {
                    alert($(xhr.responseText).html());
                }
            });
        }

        function reset() {
            $("#forgetLoginName").val('');
            $("#oldPwd").val('');
            $("#newPwd").val('');
            $("#newPwdOk").val('');
        }

        function getFlashVersion() {
            try {
                if (typeof window.ActiveXObject != 'undefined') {
                    return parseInt((new ActiveXObject('ShockwaveFlash.ShockwaveFlash')).GetVariable("$version").split(" ")[1].split(",")[0], 10);
                } else {
                    return parseInt(navigator.plugins["Shockwave Flash"].description.split(' ')[2], 10);
                }
            } catch (e) {
                return -1;
            }
        }

        function openMenu() {
            if ($("#one-menu").find("li.active").length <= 0) {
                $("body").addClass("has-subMenu");
            }
        }

        var newIndexVue = new Vue({
            el: "#newPortal",
            data: {
                weather: { city: "上海", time: "", weatherType: "", temperature: 0, min_temperature: 0, max_temperature: 0 },
                userrecord: { alarm: 0, task: 0, msg: 0 },
                curPortalList: [],
                portalStyle: "",
                menuList: [],
                Url:"",
                Name: "",
                EName: "",
                Explain: "",
                NoLoginList:[],
                bannerList: [],
                indexClass: userInfo != '' ? "index-main-list" : "index-main-list-bg",
                isEn: false,
                loginWindowInfo:{Title:"用户名",Password:"密码", Remember:"记住用户名密码",Modify:"修改密码",Button:"登录",Language:"ENGLISH SYSTEM LOGIN >"}
            },
            beforeCreate: function () {

            },
            methods: {
                openWindow: function (item) {
                    var opts = {
                        url: item.Url,
                        title: item.Title,
                        width: "80%",
                        height: "80%",
                        showMaxButton: true,
                        ondestroy: function (action) {

                        }
                    };
                    mini.open(opts);
                }
            },
            created: function () {
            },
            updated: function () {


            }
        });

        var scrollIndex = 0, mainHeight = 0, curPortalID = "";
        var lastIndexTime = null, isClickThumbnail = true, thumbnailBootom = false;
        var clientHeight = document.body.clientHeight;

        newIndexVue.$watch('curPortalList',function(val){
            var isMouseover = false;
            var shortcutTimeout = null;
            setTimeout(function(){
                if (newIndexVue.curPortalList.length > 1) {
                    setTimeout(function () {
                        if(!thumbnailBootom)
                            shortcutTimeout = setTimeout(function () {
                                $(".shortcut").animate({ bottom: "-100px" }, 600);
                                $(".shortcut_thumbnail").animate({ bottom: "0px" }, 600);
                                $(".shortcut_thumbnail").removeClass("thumbnail_down");
                                $(".shortcut_thumbnail").addClass("thumbnail_up");
                                thumbnailBootom = true;
                            }, 600);
                    }, 100);
                }
            }, 500);
        });
        $(".shortcut_thumbnail").on('click', function () {
            if(thumbnailBootom){
                $(".shortcut_thumbnail").animate({ bottom: "100px" }, 600);
                $(".shortcut").animate({ bottom: "0px" }, 600);
                $(".shortcut_thumbnail").removeClass("thumbnail_up");
                $(".shortcut_thumbnail").addClass("thumbnail_down");
                thumbnailBootom = false;
            }else{
                $(".shortcut_thumbnail").animate({ bottom: "0px" }, 600);
                $(".shortcut_thumbnail").removeClass("thumbnail_down");
                $(".shortcut_thumbnail").addClass("thumbnail_up");
                $(".shortcut").animate({ bottom: "-100px" }, 600);
                thumbnailBootom = true;
            }
        });

        var dotIndex = 1;
        setInterval(function () { 
            if(thumbnailBootom){
                if(dotIndex % 2 == 0){
                    $(".shortcut_thumbnail").animate({ bottom: "10px" }, 600);
                    $(".shortcut_thumbnail").animate({ bottom: "5px" }, 600);
                }else{
                    $(".shortcut_thumbnail").animate({ bottom: "10px" }, 600);
                    $(".shortcut_thumbnail").animate({ bottom: "5px" }, 600);
                }
            }
            dotIndex = dotIndex + 1;
        }, 10000);

        var isDisabledMouseWheel = false;
        var scrollDown = function (e) {
            var items = $(".nologin").children("div");
            if(items.length > 0){
                for (var j = 0; j < items.length; j++) {
                    var item = $(".nologin").find("#" + items[j].id + "");
                    if(item && item.hasClass('display') && j > scrollIndex){
                        switchNoLoginPortal(items[j].id, false);
                        scrollIndex == j;
                        lastIndexTime = new Date().getTime();
                        break;
                    }
                }
            }
        }
        var scrollUp = function (e) {
            var items = $(".nologin").children("div");
            if(items.length > 0){
                for (var j = items.length - 1; j >= 0; j--) {
                    var item = $(".nologin").find("#" + items[j].id + "");
                    if(item && item.hasClass('display') && j < scrollIndex){
                        scrollIndex == j;
                        switchNoLoginPortal(items[j].id, false);
                        lastIndexTime = new Date().getTime();
                        break;
                    }
                }
            }
        }
        
        var scrollFunc = function (e) {    
            if (!isDisabledMouseWheel) {
                e = e || window.event;
                var time = (new Date().getTime() - lastIndexTime) / 1000;
                if (e.wheelDelta) { //第一步：先判断浏览器IE，谷歌滑轮事件    
                    if (e.wheelDelta > 0) { //当滑轮向上滚动时 
                        if (time > 1) {
                            scrollUp();
                        }
                    }
                    if (e.wheelDelta < 0) { //当滑轮向下滚动时 
                        if (time > 1) {
                            scrollDown();
                        }
                    }
                } else if (e.detail) { //Firefox滑轮事件 
                    if (e.detail > 0) { //当滑轮向上滚动时 
                        if (time > 1) {
                            scrollUp();
                        }
                    }
                    if (e.detail < 0) { //当滑轮向下滚动时 
                        if (time > 1) {
                            scrollDown();
                        }
                    }
                }
            }
        }
       
        function scroll() {
            lastIndexTime = new Date().getTime();
            //给页面绑定滑轮滚动事件 
            if (document.addEventListener) {//firefox 
                document.addEventListener('DOMMouseScroll', scrollFunc, false);
            }
            //滚动滑轮触发scrollFunc方法 //ie 谷歌 
            window.onmousewheel = document.onmousewheel = scrollFunc;

        }

        getBanners();
        function getBanners() {
            var skinType = get("skin") == "skin_transparent_yellow" ? "Yellow" : "Blue";
            $.ajax({
                url: "GetBanners?Type=" + skinType,
                type: "GET",
                dataType: "json",
                async: false,
                success: function (data) {
                    //增加新版报错分支
                    if (data.errcode) {
                        var msg = getErrorFromHtml(data.errmsg);
                        msgUI(msg, 4);
                        return;
                    }
                    if (data && data.length > 0) {
                        var arr = new Array();
                        var path = '/PortalLTE/Images/Portal/' + skinType + '/Banner/';
                        for (var i = 0; i < data.length; i++) {
                            arr.push({ Name: path + data[i] });
                        }
                        newIndexVue.bannerList = arr;
                    }
                }
            });
        }
        
        function getMenus() {
            $.ajax({
                url: "GetPortalMenus",
                type: "get",
                dataType: "json",
                cache: false,
                success: function (data) {
                    //增加新版报错分支
                    if (data.errcode) {
                        var msg = getErrorFromHtml(data.errmsg);
                        msgUI(msg, 4);
                        return;
                    }
                    var list = $.parseJSON(data);
                    if (list && list.length > 0) {
                        var arr = new Array();
                        for (var i = 0; i < list.length; i++) {
                            var menu = {
                                ID: list[i].ID,
                                Name: list[i].Name,
                                OnClick: "ShowMenuOrPage('" + list[i].ID + "','" + list[i].Url + "','" + list[i].Name + "','" + list[i].Name + "','" + list[i].Description + "',this)"
                            };
                            arr.push(menu);
                        }
                        newIndexVue.menuList = arr;
                    }
                }
            });
        }

        function openSubMenu(cur, e) {
            var $this = $(cur);
            var checkElement = $this.next();

            if ((checkElement.is('.treeview-menu')) && (checkElement.is(':visible'))) {
                checkElement.slideUp('normal', function () {
                    checkElement.removeClass('menu-open');
                });
                checkElement.parent("li").removeClass("active");
            }
            else if ((checkElement.is('.treeview-menu')) && (!checkElement.is(':visible'))) {
                var parent = $this.parents('ul').first();
                var ul = parent.find('ul:visible').slideUp('normal');
                ul.removeClass('menu-open');
                var parent_li = $this.parent("li");
                checkElement.slideDown('normal', function () {
                    checkElement.addClass('menu-open');
                    parent.find('li.active').removeClass('active');
                    parent_li.addClass('active');
                    $.AdminLTE.layout.fix();
                });
            }
            if (checkElement.is('.treeview-menu')) {
                e.preventDefault();
            }
        }

        function ShowMenuOrPage(id, url, name, ename, explain, e) {
            $(e).addClass("active");
            $(e).siblings("li").removeClass("active");
            $("#mainView").hide();
            $("#pageItem").hide();
            $("#custab-content-menu").hide();
            isDisabledMouseWheel = true;
            $.ajax({
                url: "GetMenuHtml?parentId=" + id,
                type: "get",
                dataType: "html",
                success: function (data) {
                    //增加新版报错分支
                    if (data && typeof(data) == "string" && data.indexOf("{\"errcode\"") == 0) {
                        var fail = jQuery.parseJSON(data);
                        var msg = getErrorFromHtml(fail.errmsg);
                        msgUI(msg, 1, function (e) { window.location = "login"; });
                        return;
                    }
                    $("#sidebar-menu").html(data);
                    $("#custab-content").html("");
                    $("#custab").html("");
                    $("#page-mark").hide();
                    $("#iframe").show();
                    $("#custab-content").show();
                    $("#custab-content").css("top", topH + "px");
                    $("#custab-content").css("left", "1px");
 
                    if (data !== "") {
                        $("body").removeClass("has-subMenu").removeClass("sidebar-collapse");
                        if (url) {
                           url=GetTokenUrl(url);
                            $("#iframe").show();
                            newIndexVue.Url = url;
                            $("#custab-content").append('<li><iframe src="' + url + '"></iframe></li>');
                        } else {
                            $("#custab-content-menu").show();
                            newIndexVue.Url = "";
                            newIndexVue.Name = name;
                            newIndexVue.EName = ename;
                            newIndexVue.Explain = explain;
                        }
                    } else {
                        $("#pageItem").hide();
                        $("#iframe").show();
                        $("body").addClass("has-subMenu");
                        if (url) {
                            url=GetTokenUrl(url);
                            newIndexVue.Url = url;
                            $("#custab-content").append('<li><iframe src="' + url + '"></iframe></li>');
                        } 
                        else {
                            $("#custab-content-menu").show();
                            newIndexVue.Url = "";
                            newIndexVue.Name = name;
                            newIndexVue.EName = ename;
                            newIndexVue.Explain = explain;
                        }
                    }
                    menuAnimate();
                },
                error: function (xhr, textStatus, errorThrown) {
                    msgUI(xhr.responseText, 1, function (e) { window.location = "login"; });
                }
            });   
        }

        newIndexVue.$watch('Explain',function(val){portalResizeHeight(false);});

        newIndexVue.$watch('NoLoginList',function(val){
            setNavHeight();
            if(NoLoginPortalDic && NoLoginPortalDic.length > 0){
                switchNoLoginPortal(NoLoginPortalDic[0].ID, false);
                if(NoLoginPortalDic.length > 1){
                     setTimeout(function(){
                         if(scrollIndex < 1){
                             switchNoLoginPortal(NoLoginPortalDic[1].ID, false);
                         }
                     },2500);         
                }
            }
        });

        function setNavHeight(){
            var nav = $(".right_navigation");
            var height = NoLoginPortalDic.length * 12;
            $(nav).css("height", height + "px");
            $(nav).find("li").css("height", "calc(100% / " + NoLoginPortalDic.length + ")");
            $(nav).find("li").css("line-height", "calc(100% / " + NoLoginPortalDic.length + ")");
        }

        function doLogout() {
            $.ajax({
                url: "DoLogout",
                type: "post",
                dataType: "json",
                success: function (text) {
                    $(window).unbind('beforeunload');
                    window.onbeforeunload = null;
                    window.location = "Portal";
                },
                error: function (xhr, textStatus, errorThrown) {
                    window.location = "Portal";
                }
            });
        }

        function refresh() {
            if (userInfo == '')
                return;
            $.getJSON("GetUserProps", function (data) {
                if (!data) return;

                if (data.LogOut) {
                    msgUI("您的帐号异地登录,系统将强制退出!", 1, function (action, t) { doLogout(); });
                }
                else {
                    $("#AlarmCount,#AlarmCount1,#userinfo_alarm").text(data.AlarmCount);
                    $("#TaskCount,#TaskCount1,#userinfo_task").text(data.TaskCount);
                    $("#MsgCount,#MsgCount1,#userinfo_msg").text(data.MsgCount);
                    newIndexVue.userrecord.alarm = data.AlarmCount;
                    newIndexVue.userrecord.task = data.TaskCount;
                    newIndexVue.userrecord.msg = data.MsgCount;
                    if(data.AlarmCount > 0)
                        $("#userinfo_alarm").show();
                    if(data.TaskCount > 0)
                        $("#userinfo_task").show();
                    if(data.MsgCount > 0)
                        $("#userinfo_msg").show();
                }
            });
        }
        refresh();
        setInterval(refresh, 30000);
        function openWindow(url, title, width, height) {
            var opts = {
                url: url,
                title: title,
                width: width,
                height: height,
                showMaxButton: true,
                ondestroy: function (action) {

                }
            };
            mini.open(opts);
        }
        function openMsg() {
            var title = LGID == "EN" ? "My Messge" : "我的消息";
            openWindow("/Base/ShortMsg/Msg/Index", title, "80%", "80%");
        }
        function openTask(status) {
            var title = LGID == "EN" ? "My Task" : "我的任务";
            status = (status == 'Done' ? 'Done' : "Undo");
            openWindow("/MvcConfig/WorkFlow/Task/MyTaskCenter?Status=" + status, title, "80%", "80%");
        }
        function openAlarm() {
            var title = LGID == "EN" ? "My Mind" : "我的提醒";
            openWindow("/Base/ShortMsg/Alarm/list", title, "80%", "80%");
        }
        function openUIF() {
            openWindow("/Base/Auth/User/UserInfo", "个人信息维护", "360", "400");
        }

        function saveShortCut(txtTitle, txtUrl, iconUrl) {
            msgUI("确认添加到快捷入口吗？", 2, function (action) {
                if (action == "ok") {
                    if ($.trim(txtTitle) == "") {
                        msgUI("请输入快捷入口名称：", 5, function (action, t) {
                            if (action == "ok") {
                                if ($.trim(t) == "") {
                                    msgUI("快捷入口名称不能为空");
                                    return;
                                }
                                saveShortCutData(t, txtUrl, iconUrl);
                            }
                        });
                    }
                    else {
                        saveShortCutData(txtTitle, txtUrl, iconUrl);
                    }
                }
            });
        }

        function saveShortCutData(txtTitle, txtUrl, iconUrl) {
            var data = {
                Url: txtUrl,
                Name: txtTitle,
                IsUse: "T",
                Type: "Normal",
                IconImage: iconUrl,
                PageIndex: 0
            };
            var executeParams = new Object();
            executeParams["FormData"] = mini.encode(data);
            execute("/Base/PortalBlock/ShortCut/Add", {
                validateForm: false,
                execParams: executeParams,
                onComplete: function (data) {
                    msgUI("　　[" + txtTitle + "] 模块已添加到首页快捷菜单板块！");
                    bindShortcut();
                }
            });
        }

        $(document).ready(function () {
            if (userInfo != '') {
                initShortcut();
                $(".login-window").hide();
            }else {
                $(".shortcut_thumbnail").hide();
                $(".homedot").css('bottom', '10px');
            }
            openMenu();
        });

        var scIsHidden = true;
        function initShortcut() {
            bindShortcut();
            $("#imgShortcut").hover(
        function () {
            $(".shortcutmenu").fadeIn();
            scIsHidden = false;
        },
        function () {
            scIsHidden = true;
            setTimeout('if (scIsHidden) {$(".shortcutmenu").fadeOut();}', 200);
        });
            $(".shortcutmenu").hover(
        function () {
            $(".shortcutmenu").fadeIn();
            scIsHidden = false;
        },
        function () {
            scIsHidden = true;
            setTimeout('if (scIsHidden) {$(".shortcutmenu").fadeOut();}', 200);
        });
        }

        function bindShortcut() {
            execute("/Base/PortalBlock/ShortCut/Select", {
                showLoading: false,
                onComplete: function (data) {
                    var $ul = $("#ulShortcut");
                    $ul.children().remove();
                    $.each(data, function (i, item) {
                        var $left = $("<span></span>").addClass("shortcutmenu_span_left").append($("<a></a>").attr("href", "javascript:void(0);").text(item.Name).click(function () { openShortcut(item.Url, item.Name); }));
                        var $img = $('<img src="/Base/Scripts/ShortMsg/delete.png" alt="删除" name="delete" width="16" height="16" align="absmiddle" border="0" />').mouseout(function () { MouseChange(this, '/Base/Scripts/ShortMsg/delete.png'); }).mouseover(function () { MouseChange(this, '/Base/Scripts/ShortMsg/deleteon.png'); });
                        var $right = $("<span></span>").addClass("shortcutmenu_span_right").hide().append($("<a></a>").attr("href", "javascript:void(0);").click(function () { delShortcut(item.ID, item.Name); }).append($img));
                        $ul.append($("<li></li>").mouseover(function () { $(this).addClass("shortcutmenu_onmouse"); $(this).find(".shortcutmenu_span_right").show(); }).mouseout(function () { $(this).removeClass("shortcutmenu_onmouse"); $(this).find(".shortcutmenu_span_right").hide(); }).append($left).append($right));
                    });
                }
            });
        }

        function openShortcut(url, title) {
            openWindow(url, title, "80%", "80%");
            $(".shortcutmenu").hide();
        }

        function delShortcut(id, name) {
            msgUI("确认删除" + name + "吗?", 2, function (action) {
                if (action == "ok") {
                    execute("/Base/PortalBlock/ShortCut/DeleteShortCut?ID=" + id, {
                        onComplete: function (data) {
                            bindShortcut();
                            GetShortCut();
                            msgUI("删除成功！");
                        }
                    });
                }
            });
        }

        //鼠标移入移出按钮图标切换事件
        function MouseChange(obj, e) {
            obj.src = e;
        }

    </script>
    <script type="text/javascript">
        var dashboard = {
            Set: function (key, value) { this[key] = value },
            Get: function (key) { return this[key] },
            Contains: function (key) { return this.Get(key) == null ? false : true },
            Remove: function (key) { delete this[key] }
        };
        function dashboardChanged(e) {
            var dashboards = $('section[id^="dashboard_"]');
            for (var i = 0; i < dashboards.length; i++) {
                var child = $("#" + dashboards[i].id).children("div[class^='box']");
                var ids = new Array();
                for (var j = 0; j < child.length; j++) {
                    if (!$("#" + child[j].id).is(":hidden") && child[j].id != e)
                        ids.push(child[j].id);
                }
                if (dashboard.Contains(dashboards[i].id)) {
                    dashboard.Remove(dashboards[i].id);
                }
                dashboard.Set(dashboards[i].id, ids.toString().replace(/,/g, '&'));
            }

            if (Object.keys(dashboard).length < 5)
                return;

            var json = new Array();
            for (var i = 4; i < Object.keys(dashboard).length; i++) {
                var key = Object.keys(dashboard)[i];
                if (key) {
                    json.push(key + ':' + dashboard.Get(key));
                }
            }
            var tid = $('section div[tid]:eq(0)').attr('tid');
            if (tid == null)
                return;
            $.ajax({
                url: "SaveUserTemplet?ID=" + tid,
                type: "post",
                data: { json: json.toString() },
                cache: false,
                dataType: "json",
                success: function (data) {
                    //增加新版报错分支
                    if (data.errcode) {
                        var msg = getErrorFromHtml(data.errmsg);
                        msgUI(msg, 4);
                        return;
                    }
                },
                error: function (xhr, textStatus, errorThrown) {

                }
            });
        }

        //iframe跳转
        function goUrl(e) {
            $("#sidebar-menu").find('li.active').removeClass('active');
            $(e).parent("li").addClass('active');

            if ($("#custab-content").css("top") == (topH + "px")) {
                $("#custab-content").css("top", "");
                $("#custab-content").css("left", "");
                $("#custab-content").html("");
            }
            var url = $(e).attr("ui-href");
            if (url) {
                url=GetTokenUrl(url);
            }
            else
                return;
            var curli;
            var tablis = $("#custab").find("li");
            //判断是否在tab页中打开
            var hasTab = tablis.filter(function () {
                return $(this).data("custaburl") === url;
            });
            $("#pageItem").hide();
            $("#custab-content-menu").hide();
            if (hasTab.length === 0) {
                var title = $(e).text();
                var className = "";
                var length = tablis.length;
                if (length === 0) {
                    $("#page-mark").hide();
                    className = "class='active'";
                } else {
                    $("#page-mark").show();
                }


                if (tablis.length >= 5) {
                    $("#custab").find("li:eq(0)").remove();
                    $("#custab-content").find("li:eq(0)").remove();
                }
                $("#custab").append('<li ' + className + ' onclick=showCurTab(this)  data-custaburl=' + url + '>' + title + '<i class="fa fa-remove" onclick="closeCustomTab(this,event)"></i></li>');
                var src = window.location.protocol + '//' + window.location.host + url;
                if(url.indexOf("http")>=0){
                    src=url;
                }
                $("#custab-content").append('<li ' + className + '><iframe src="' + src + '"></iframe></li>');

                curli = $("#custab").find("li").last();
                $("#mainView").hide();
                $("#iframe").show();
            } else {
                curli = hasTab[0];
            }
            //显示当前页
            showCurTab(curli);
        }

        //子页面调用
        function goUrlByFrame(url,title)
        {
            //$("#sidebar-menu").find('li.active').removeClass('active');
            //$(e).parent("li").addClass('active');

            if ($("#custab-content").css("top") == (topH + "px")) {
                $("#custab-content").css("top", "");
                $("#custab-content").css("left", "");
                $("#custab-content").html("");
            }
            if (url) {
                url=GetTokenUrl(url);
            }
            else
                return;
            var curli;
            var tablis = $("#custab").find("li");
            //判断是否在tab页中打开
            var hasTab = tablis.filter(function () {
                return $(this).data("custaburl") === url;
            });
            $("#pageItem").hide();
            $("#custab-content-menu").hide();
            if (hasTab.length === 0) {
                var className = "";
                var length = tablis.length;
                if (length === 0) {
                    $("#page-mark").hide();
                    className = "class='active'";
                } else {
                    $("#page-mark").show();
                }


                if (tablis.length >= 5) {
                    $("#custab").find("li:eq(0)").remove();
                    $("#custab-content").find("li:eq(0)").remove();
                }
                $("#custab").append('<li ' + className + ' onclick=showCurTab(this)  data-custaburl=' + url + '>' + title + '<i class="fa fa-remove" onclick="closeCustomTab(this,event)"></i></li>');
                var src = window.location.protocol + '//' + window.location.host + url;
                if(url.indexOf("http:")){
                    src=url;
                }
                 $("#custab-content").append('<li ' + className + '><iframe src="' + src + '"></iframe></li>');

                curli = $("#custab").find("li").last();
                $("#mainView").hide();
                $("#iframe").show();
            } else {
                curli = hasTab[0];
            }
            //显示当前页
            showCurTab(curli);
        }
        //重置布局配置
        function resetSetting(e) {
            if ($(e).prop("checked") == true) {
                $.ajax({
                    url: "SaveSettings",
                    data: { settings: "" },
                    type: "post",
                    dataType: "json",
                    success: function (data) {
                        //增加新版报错分支
                        if (data.errcode) {
                            var msg = getErrorFromHtml(data.errmsg);
                            msgUI(msg, 4);
                            return;
                        }
                        window.location.reload();
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        alert(xhr.responseText);
                    }
                });
            }
        }

        function lockPortal(e) {
            setCache('isLockPortal', $('#portal-lock').is(':checked'));
            window.location.reload();
        }

        //返回首页
        function gohome() {
            $("#mainView").show();
            $("#pageItem").hide();
            $("#iframe").hide();
            $("#one-menu").find("li").removeClass("active");
            $("body").addClass("has-subMenu");
            isDisabledMouseWheel = false;
        }

        //关闭自定义Tab栏
        function closeCustomTab(cur, e) {
            e.preventDefault();
            e.stopPropagation();
            var curTab = $(cur).parent();
            var index = curTab.index();
            curTab.remove();
            $("#custab-content").find("li:eq(" + index + ")").remove();
            if (curTab.hasClass("active")) {
                $("#custab").find("li:eq(0)").addClass("active");
                $("#custab-content").find("li:eq(0)").addClass("active");
            }
            var length = $("#custab").find("li").length;
            if (length <= 1) {
                $("#page-mark").hide();
            }
            if (length === 0) {
                if (newIndexVue && newIndexVue.Url != "") {
                    $("#custab-content").css("top", topH + "px");
                    $("#custab-content").css("left", "1px");
                    $("#custab-content").show();
                    $("#custab-content-menu").hide();
                    $("#custab-content").append('<li><iframe src="' + newIndexVue.Url + '"></iframe></li>');
                } else {
                    $("#custab-content-menu").show();
                }
            }
            portalResizeHeight(false);
        };

        //显示当期Tab
        function showCurTab(e, dom) {
            dom = $(e) || dom;
            dom.addClass("active");
            dom.siblings("li").removeClass("active");
            var index = dom.index();
            var choTab = $("#custab-content").find("li:eq(" + index + ")");
            choTab.addClass("active");
            choTab.siblings("li").removeClass("active");
        }

        $(".box").show();
        //优化加载，页面渲染完后在显示box
        //        document.onreadystatechange = function () {
        //            if (document.readyState == "complete") //当页面加载状态
        //            {
        //                $(".box").each(function () {
        //                    $(this).show();
        //                });
        //            }
        //        };

        //滚动条样式控制
        $(".nicescroll").niceScroll({ cursorcolor: "#dfdfdf", cursorwidth: "3px" });
    </script>
    <script type="text/javascript">


        function store(name, val) {
            setCache(name, val);
        }
        function get(name) {
            return getCache(name);
        }
        var collapsed = get("collapsed");
        if (collapsed) {
            var arr = collapsed.split(',');
            for (var i = 0; i < arr.length; i++) {
                $("#" + arr[i]).addClass("collapsed-box");
            }
        }
        function openUserTemplet(id) {
            $("#df-" + id).hide();
            $(".templet-list").show(500);
        }
        function switchTemplet(id) {
            var href = window.location.href;
            if (href.indexOf('?') >= 0) {
                href = href.substr(0, href.indexOf('?'));
            }
            href = href.split('#')[0];
            window.location.href = href + '?ID=' + id;
        }
        $(document).click(function (e) {
            var templetList = $('.templet-list');
            var templetDefault = $('.templet-default');
            var divTempletDefault = $('.templet-default div');
            if (!templetList.is(e.target) && templetList.has(e.target).length === 0
                && !templetDefault.is(e.target) && templetDefault.has(e.target).length === 0) {
                templetList.hide();
                divTempletDefault.show();
            }
        });

        var curClick = false, pageCount = 1, curNextPage = 1;

        function menuAnimate() {
            var liarray = new Array();
            linum = $('#two-menu').length;
            ulw = $('#one-menu').width(); 
            $('#two-menu li').each(function (index, event) {
                var id = $(this).attr('id');
                var liw = $(this)[0].clientWidth + 10;//加上边距
                if (id)
                    liarray.push(id + ',' + liw);
            });

            var wall = 0;
            for (var i = 0; i < liarray.length; i++) {
                if (liarray[i].split(',')[1]) {
                    wall = wall + parseInt(liarray[i].split(',')[1]);
                }
            }

            if (wall <= ulw && !curClick) {
                $('.menu_next').hide();
                $('.menu_prev').hide();
                $("#one-menu").removeClass("menu_padding");
            } else {
                var twoStyle = $('#two-menu').attr('style');
                if (!twoStyle)
                    $("#one-menu").addClass("menu_padding");
                $('.menu_next').show();
                $('.menu_prev').show();
            }
            return wall + ',' + ulw;
        }

        $('.menu_next').click(function () {
            var _width = menuAnimate();
            var wall = parseInt(_width.split(',')[0]) + 230;
            var ulw = parseInt(_width.split(',')[1]);
            pageCount = wall < ulw ? 1 : wall == ulw ? parseInt(wall / ulw) : parseInt(wall / ulw) + 1;
            if ($('#two-menu').is(':animated')) {
                $('#two-menu').stop(true, true);
            }

            if (wall > ulw) {
                var width = ulw * curNextPage;
                var liarray = new Array();
                var curWidth = 0;
                if (curNextPage < pageCount) {
                    $('#two-menu li').each(function (index, event) {
                        var id = $(this).attr('id');
                        var liw = $(this)[0].clientWidth;
                        if (id) {
                            curWidth = curWidth + liw;
                            if (curWidth > width) {
                                width = curWidth - liw;
                                return false;
                            }
                        }
                    });
                    if (curNextPage + 1 == pageCount)
                        width = wall - ulw;
                    //if (!$("body").hasClass('sidebar-collapse'))
                    //    width = width + 230;
                    $('#two-menu').animate({ left: '-' + width + 'px' }, 'slow');

                    if (curNextPage < pageCount)
                        curNextPage = curNextPage + 1;
                }
            }

            curClick = true;
        });


        $('.menu_prev').click(function () {
            var _width = menuAnimate();
            var wall = parseInt(_width.split(',')[0]);
            var ulw = parseInt(_width.split(',')[1]);
            if ($('#two-menu').is(':animated')) {
                $('#two-menu').stop(true, true);
            }

            if (wall > ulw && curClick) {
                $('#two-menu').animate({ left: '0px' }, 'slow');
            }
            curNextPage = 1;
            curClick = false;
        });

        $(document).ready(function (e) {
            menuAnimate();
        });

        function onMouseOverMenu(type) {
            if (type == 1) {
                var img = document.getElementById("prevImg");
                img.src = "/PortalLTE/Images/bt-left-on.png";
            } else {
                var img = document.getElementById("nextImg");
                img.src = "/PortalLTE/Images/bt-right-on.png";
            }
        }
        function onMouseOutMenu(type) {
            if (type == 1) {
                var img = document.getElementById("prevImg");
                img.src = "/PortalLTE/Images/bt-left.png";
            } else {
                var img = document.getElementById("nextImg");
                img.src = "/PortalLTE/Images/bt-right.png";
            }
        }

        window.onbeforeunload = function (e) {
            try {
                event.preventDefault();
            } catch (e) {

            }
        }

        var curUserInfoState = false;
        if (userInfo != '') {
            $(".sidebar-toggle").show();
            $("#copyright").hide();
            $("body").addClass("sidebar-collapse");
            curUserInfoState = true;
            GetPortals();
        } else {
            $(".sidebar-toggle").hide();
            if(NoLoginPortalDic){
                if(NoLoginPortalDic.length > 0){
                    for (var i = 0; i < NoLoginPortalDic.length; i++) {
                        for (var key in NoLoginPortalDic[i]) {
                            NoLoginPortalDic[i][key] = NoLoginPortalDic[i][key];  
                            NoLoginPortalDic[i]['Click'] = "switchNoLoginPortal('" + NoLoginPortalDic[i].ID + "',true)";
                        }
                    }
                    newIndexVue.NoLoginList = NoLoginPortalDic;
                }
            }  
            scroll();
            var loginWindow = $(".login-window");
            loginWindow.animate({ top: 35 }, 800);
        }

        function switchNoLoginPortal(id, is){
            if(newIndexVue.NoLoginList && newIndexVue.NoLoginList.length >0){
                var line = $(".nologin-left,.nologin-right");
                line.addClass("display");
                line.css("height", 0);
                for (var i = 0; i <  newIndexVue.NoLoginList.length; i++) {
                    if(newIndexVue.NoLoginList[i].ID == id){
                        if(i != 0){
                            line.removeClass("display");
                            line.animate({ height: $(window).height() }, 800);
                        }
                        var items = $(".nologin").children("div");
                        if(items.length > 0){
                            for (var j = 0; j < items.length; j++) {
                                if(j != 0){
                                    $(items[j]).css("margin-top", $(window).height());
                                }
                                var item = $(".nologin").find("#" + items[j].id + "");
                                if(items[j].id == id){    
                                    item.removeClass("display");
                                    $(item).find(".nologin-normal,.nologin-section").css("bottom",-($(window).height()));
                                    $(item).find(".nologin-normal,.nologin-section").animate({ "bottom": 45 },{ duration: 1200, specialEasing:{"bottom":"easeOutExpo" }});
                                    if(j == 0)
                                         $("#index-main-list").removeClass("bg-color");
                                    else{
                                         $("#index-main-list").addClass("bg-color");
                                    }
                                }else{
                                    item.addClass("display");
                                }
                            }
                            var nav_li = $(".right_navigation li");
                            if(nav_li.length > 0){
                                for (var n = 0; n < nav_li.length; n++) {
                                    if(nav_li[n].id == id){    
                                        scrollIndex = n;
                                        curPortalID = id;                                     
                                        $(nav_li[n]).find("hr").addClass("nav_li_hr_over");
                                        $(nav_li[n]).find("label").removeClass("display");
                                        $(nav_li[n]).find("label").addClass("nav_li_over");
                                    }else{
                                        $(nav_li[n]).removeClass("nav_li_over");
                                        $(nav_li[n]).find("hr").removeClass("nav_li_hr_over");
                                        $(nav_li[n]).find("label").removeClass("nav_li_over");
                                        if(!is)
                                            $(nav_li[n]).find("label").addClass("display");
                                    }
                                }
                            }
                        }
                        break;
                    }
                }
            }
        }

        function onMouseOverPortal(event, type){
            if(event.id != curPortalID){
                if(type == 0){
                    $(event).addClass("nav_li_over");
                    $(event).find("hr").addClass("nav_li_hr_over"); 
                }else{
                    $(event).removeClass("nav_li_over");
                    $(event).find("hr").removeClass("nav_li_hr_over"); 
                }
            }else{
                $(event).removeClass("nav_li_over");
            }
        }
        
        if(userInfo == ''){
            var overTime = 0;
            document.getElementById("noLoginNavigation").onmouseover = function(e){    
                if( !e ) e = window.event;    
                var reltg = e.relatedTarget ? e.relatedTarget : e.toElement;    
                while( reltg && reltg != this ) reltg = reltg.parentNode;    
                if( reltg != this ){
                    if(new Date().getTime() - overTime > 600)
                    {
                        onMouseOverNavigation(0);
                        overTime = new Date().getTime();
                    }
                }  
            }  

            document.getElementById("noLoginNavigation").onmouseout = function(e){    
                if( !e ) e = window.event;    
                var reltg = e.relatedTarget ? e.relatedTarget : e.toElement;    
                while( reltg && reltg != this ) reltg = reltg.parentNode;    
                if( reltg != this ){    
                    onMouseOverNavigation(1);
                }  
            }  
        }

        function onMouseOverNavigation(type){
            var nav_li = $(".right_navigation li");
            if(nav_li.length > 0){
                if(type == 0){
                    var height = NoLoginPortalDic.length * 30;
                    $(".right_navigation").animate({ height: height + "px" }, 150);
                    for (var n = 0; n < nav_li.length; n++) {
                        $(nav_li[n]).find("label").removeClass("display");
                    }

                }else{
                    for (var n = 0; n < nav_li.length; n++) {
                        if(curPortalID != nav_li[n].id)
                            $(nav_li[n]).find("label").addClass("display");
                    }
                    var height = NoLoginPortalDic.length * 12;
                    $(".right_navigation").animate({ height: height + "px" }, 150);
                }
            }
        }

        function GetPortals() {
            var id = getQueryString("ID");
            $.ajax({
                url: "/PortalLTE/Main/GetPortals",
                type: "get",
                dataType: "json",
                cache: false,
                success: function (data) {
                    //增加新版报错分支
                    if (data.errcode) {
                        var msg = getErrorFromHtml(data.errmsg);
                        msgUI(msg, 4);
                        return;
                    }
                    var list = $.parseJSON(data);
                    for (var l = 0; l < list.length; l++) {
                        for (var key in list[l]) {
                            list[l][key] = list[l][key];
                            list[l]['Click'] = "switchTemplet('" + list[l].TempletID + "')";
                            list[l]['Src'] = "/PortalLTE/Images/defaultLogin.jpg";
                            if (id != undefined && id != '') {
                                list[l]['Check'] = list[l].TempletID == id;
                            } else {
                                if (l == 0)
                                    list[l]['Check'] = true;
                            }
                        }
                    }
                    var width = list.length * 130;
                    newIndexVue.curPortalList = list;
                    if(list.length > 1)
                        $(".shortcut,.shortcut_thumbnail").show();
                    newIndexVue.portalStyle = "margin-left: calc(50% - " + (width / 2) + "px);";
                },
                error: function (xhr, textStatus, errorThrown) {
                    alert(xhr.responseText);
                }
            });
        }
    
        function showShortCutAndUserInfo() {
            if (curUserInfoState) {
                var list = newIndexVue.shortCurList;
                if (list && list.length > 0) {
                    $('.direction img')[0].src = "/PortalLTE/Images/shortcut-left.png";
                    curUserInfoState = false;
                    $('.usermsg').show();
                    $('.shortcurlist').hide();
                } else {
                    $('.usermsg').hide();
                    $('.shortcurlist').show();
                }
            } else {
                curUserInfoState = true;
                $('.direction img')[0].src = "/PortalLTE/Images/shortcut-right.png";
                $('.usermsg').hide();
                $('.shortcurlist').show();
            }
        }
    </script>
    <script src="~/Scripts/plugins/Encrypt.js"></script>
    <script>

        function lostpassword() {
            var window = mini.get('forgetWindow');
            if (!window) { msgUI("未找到指定的window窗体！", 4); return; }
            window.onscroll = scroll;
            window.queryWindowId = window.id;
            window.show();
        }

        function login() {
            if (navigator.appName == "Microsoft Internet Explorer") {
                var ie = navigator.appVersion.split(";")[1].replace(/[ ]/g, "");
                if (ie == "MSIE6.0" || ie == "MSIE7.0" || ie == "MSIE8.0") {
                    msgUI("您使用的IE浏览器版过过低,请升级到IE8以上!");
                    return;
                }
            }
            
            $("#btnLogin").attr("disabled", "true");
            $("#btnLogin").css("background-color", "#888");
            $("#btnLogin").text("登录验证中……");
            var pswStr = $("#password").val();
            if (pswStr.length < 23) pswStr = Encrypt(pswStr);
            $.ajax({
                url: "DoLogin",
                data: { loginName: $("#loginName").val(), password: pswStr, LGID: newIndexVue.isEn ? "EN" : "" },
                type: "post",
                dataType: "json",
                success: function (data) {
                    //增加新版报错分支
                    if (data.errcode) {
                        var msg = getErrorFromHtml(data.errmsg);
                        msgUI(msg, 1, function () {
                            $("#btnLogin").attr("disabled", false);
                            $("#btnLogin").css("background-color", "#0099cc");
                            $("#btnLogin").html("登&nbsp;&nbsp;&nbsp;录");
                        });
                        return;
                    }
                    if ($("#rememberUserAndPwd")[0].checked == true) {
                        store("loginName", $("#loginName").val());
                        store("password", pswStr);
                    }
                    else {
                        store("loginName", "");
                        store("password", "");
                    }
                    store("rememberUserAndPwd", $("#rememberUserAndPwd").prop("checked"));
                    $(window).unbind('beforeunload');
                    window.onbeforeunload = null;
                    window.location = "Portal";
                },
                error: function (xhr, textStatus, errorThrown) {
                    msgUI(xhr.responseText, 1, function () {
                        $("#btnLogin").attr("disabled", false);
                        $("#btnLogin").css("background-color", "#0099cc");
                        $("#btnLogin").html("登&nbsp;&nbsp;&nbsp;录");
                    });
                }
            });
        }

        function EnterKeyDown(evt) {
            evt = (evt) ? evt : ((window.event) ? window.event : "");
            var keyCode = evt.keyCode ? evt.keyCode : evt.which;
            if (keyCode == 13) {
                evt.returnValue = false;
                evt.cancel = true;
                login();
            }
        }
</script>
<script>
    function store(name, val) {
        setCache(name, val);
    }
    function get(name) {
        return getCache(name);
    }

    var topWin = null;
    function GetTopWindow(win) {
        if (win.parent != win) {
            GetTopWindow(win.parent);
        }
        if (topWin == null)
            topWin = win;
        else
            return;
    }

    $(document).ready(function () {
        GetTopWindow(window);
        if (topWin != window) {
            //防止重新登陆时外框消失
            topWin.location.href = "/portalLTE/Main/Login";
            return false;
        }
        else {
            var backImg = "/PortalLTE/Images/defaultLogin.jpg";

            if (get("background-image-login") != null)
                backImg = get("background-image-login");

            //检查本地缓存中的图片是否存在，如果不存在，就默认图片，并将缓存内的背景改为默认图片
            $.ajax(backImg, {
                type: 'get',
                timeout: 1000,
                success: function () {
                    $("#loginBackground").css("background-image", "url(" + backImg + ")");
                },
                error: function () {
                    backImg = "/PortalLTE/Images/defaultLogin.jpg";
                    store("background-image-login", backImg);
                    $("#loginBackground").css("background-image", "url(" + backImg + ")");
                }
            });

            var loginName = get("loginName");
            var password = get("password");
            var rememberUserAndPwd = get("rememberUserAndPwd") === "true";
            if (loginName)
                $("#loginName").val(loginName);
            if (password)
                $("#password").val(password);
            $("#rememberUserAndPwd").prop("checked", rememberUserAndPwd);

            $("#loginName").focus();

 

            resizeHeight();
        }
    });

    function resizeHeight() {
        $(".main-div-bg,.nologin").css("height", $(window).height());
        if(userInfo != ''){
            var ut = $(".user-board").length > 0 ? 0 : 10;
            $("#index-main-list").css('top', topH + ut);
        }else{
            $("#index-main-list").css("height", $(window).height());
            $(".nologin_home_ad").css("margin-top", $(window).height()/2 - 110 - 171/2);
            var items = $(".nav_nologin_list");
            items.css("height", $(window).height() - 100);
            if(items.length > 0){
                for (var i = 0; i < items.length; i++) {
                    if(i > 0)
                        $(items[i]).css("margin-top", $(window).height());
                }
            }
        }

        var i, left, right, box, boxli, boxleng, width, dot, first, last, IsAuto;

        i = 0;

        left = $(".homeleft");

        right = $(".homeright");

        box = $(".homebanner ul");

        boxli = $(".homebanner li");

        dotbox = $(".homedot");

        dot = $(".homedot").find("a");

        width = $(window).width();

        boxleng = boxli.length;
       
        box.css({ width: width * (boxleng) })

        boxli.css({ width: width });

        dot.eq(0).addClass("cur");

        boxli.eq(0).addClass("cur");

        boxli.each(function (index) {
            zindex = boxleng - (index + 1);
            $(this).css({ "z-index": zindex })
        });

        IsAuto = true;

        left.click(function () {
            if (box.is(":animated")) { return }
            i--;
            if (i < 0) { i = boxleng - 1 };
            boxanimate();

        })

        right.click(function () {
            if (box.is(":animated")) { return }
            i++;
            boxanimate();
        })

        function boxanimate() {
            if (i > boxleng - 1) { i = 0 }
            boxli.addClass("cur1");
            setTimeout(function () {
                boxli.removeClass("cur1");
                boxli.removeClass("cur").eq(i).addClass("cur");
                boxli.stop().animate({ opacity: 0, "z-index": "1" }, 500).eq(i).stop().animate({ opacity: 1, "z-index": boxleng }, 500);
                bannerdot(i)
            }, 400)
        }

        function bannerdot(i) {
            if (i > boxleng - 1) { i = 0 }
            dot.removeClass("cur").eq(i).addClass("cur");
        }

        dot.click(function () {
            i = $(this).index();
            bannerdot(i);
            boxanimate(i);
        })

        setInterval(function () {
            if (IsAuto) {
                i++;
                boxanimate();
                bannerdot(i)
            }
        }, 6000)

        box.hover(function () {
            IsAuto = false;
        }, function () {
            IsAuto = true;
        })

        dotbox.hover(function () {
            IsAuto = false;
        }, function () {
            IsAuto = true;
        })

        left.hover(function () {
            IsAuto = false;
        }, function () {
            IsAuto = true;
        })

        right.hover(function () {
            IsAuto = false;
        }, function () {
            IsAuto = true;
        })
    }
    $(window).resize(function () {
        resizeHeight();
        portalResizeHeight(false);
    });

    portalResizeHeight(true);
    function portalResizeHeight(is) {
        if (is) {
            $("#_menuExplain").css("margin-top", 170);
        } else {
            var clientHeight = document.body.clientHeight;
            var expHeight = $("#_menuExplain").height();
            $("#_menuExplain").css("margin-top", (clientHeight / 2 - expHeight / 2) - topH);
        }

    }

    function closeLoginWindow(){
        $(".login-close").hide();
        $(".login-window").hide(500);
        $(".login-user").show(500);
    }

    function openLoginWindow() {
        $(".login-close").show();
        var loginWindow = $(".login-window");
        $(".login-user").hide(500);
        loginWindow.css("top","-300px");
        loginWindow.css("display","block");
        loginWindow.animate({ top: 35 }, 800);
    }

    function switchLanguage(){
        if(typeof(newIndexVue) != 'undefined'){
            if(!newIndexVue.isEn){
                newIndexVue.loginWindowInfo = {
                    Title:"Username",
                    Password:"Password", 
                    Remember:"REMENBER",
                    Modify:"PASSWORD",
                    Button:"LOGIN",
                    Language:"中文系统登录 >"
                };
            }else{
                newIndexVue.loginWindowInfo = {
                    Title:"用户名",
                    Password:"密码", 
                    Remember:"记住用户名密码",
                    Modify:"修改密码",
                    Button:"登录",
                    Language:"ENGLISH SYSTEM LOGIN >"
                };
            }
            newIndexVue.isEn = !newIndexVue.isEn;
        }
    }
    
    //-------------------------增加门户左侧快捷方式----------------------------------//
    function bindLeftShortCut(mainDom, topDom,logoDom) {

        $(".shortcut").css("left","0px");
        var sortshortcut=[];
        var mainDomwidth=0;
        var selectID="";
        var settype="";
        $(window).resize(function () {
            if(mainDom[0]&&$(".rightshorcut")&&$(".shortcut-close")){
                mainDomwidth=mainDom[0].clientWidth-280;
                var mainDomheight=document.body.clientHeight-66;
                $(".rightshorcut").height(mainDomheight);
                $(".rightshorcut").css("left",250-mainDomwidth+"px").css({ "left": '250px' }, '300');
                $(".rightshorcut").width(mainDomwidth);
                $(".shortcut-close").css("left",(250+mainDomwidth)+"px");
            }          
        });

        function loadShortCut(mainDom,type){
            settype=type;
            $.ajax({
                url: "/PortalLTE/Main/GetShortCut",
                type: "get",
                dataType: "json",
                success: function (sdata) {
                    $("#shortCutUl").html("");
                    sdata = JSON.parse(sdata);                   
                    if (sdata.length > 0) {                       
                        sortshortcut=[];
                        for (var i=0;i<sdata.length ;i++) {
                            var _shtml= $(' <li class="returnurl"><a href="#"  style="padding: 12px 5px 12px 15px;display: block;"><i class="'+ sdata[i].IconImage+'"></i> <span>'+ sdata[i].Title+'</span><i class="fa fa-angle-left pull-right" style="transform: rotate(-180deg);"></i></a></li>');
                            var _sehtml= $(' <li class="returnedit" style="display:none;position: relative;margin: 0;padding: 0;padding: 12px 5px 12px 15px;"><i class="'+ sdata[i].IconImage+'"></i> <span>'+ sdata[i].Title+'</span></li>');
                            var _liicon=$("<div class='shortcut-icon'></div>");
                            var _liremove=$("<div class='shortcut-del'></div>");                           
                            var _liselect=$("<div  class='shortcut-unselect shortcut-sortin'></div>");
                            if(sdata[i].ID==selectID){
                                _liselect=$("<div  class='shortcut-select shortcut-sortin'></div>");
                            }else{
                                _liselect=$("<div  class='shortcut-unselect shortcut-sortin'></div>");
                            }
                            //var _liunselect=$("<div class='shortcut-unselect'></div>");
                            var sortitem={
                                ID:sdata[i].ID,
                                sortindex:(i+1).toString()
                            }


                            sortshortcut.push(sortitem);
                            //增加操作按钮    
                            _sehtml.append(_liselect);
                            _sehtml.append(_liremove);
                            _sehtml.append(_liicon);
                            //_sehtml.append(_lidown);
                            // 选择图标

                            _liicon.click(sdata[i].ID,function (udata) {
                                var opts = {
                                    url: '/PortalLTE/icons.html',
                                    title: "选择图标",
                                    width: 800,
                                    height: 500,
                                    showMaxButton: true,
                                    ondestroy: function (data) {
                                        if (data != "close") {
                                            $.ajax({
                                                url: "/PortalLTE/Main/SetShortCutIcon?ID=" +udata.data+"&Icon="+data,
                                                type: "get",
                                                dataType: "json",
                                                success: function () {
                                                    loadShortCut(mainDom,"edit");
                                                },
                                                error: function (xhr, textStatus, errorThrown) {
                                                    alert(xhr.responseText);
                                                }
                                            });
                                        }
                                    }
                                };
                                mini.open(opts);
                            });
                            _sehtml.click(sdata[i].ID,function (udata) {  
                                var shortdisplay =$('.shortcut-sortin').css('display');
                                if(shortdisplay == 'none'){  
                                    return;
                                }                              
                                selectID=udata.data;
                                $(".shortcut-sortin").removeClass("shortcut-select"); 
                                $(".shortcut-sortin").addClass("shortcut-unselect");  
                                $(this).find("div").removeClass("shortcut-unselect");  
                                $(this).find("div").addClass("shortcut-select");                   
                                $(".shortcut-up").css("background-color","#cccccc");
                                $(".shortcut-down").css("background-color","#cccccc");
                                for(var j=0;j<sortshortcut.length;j++){
                                    if(sortshortcut[j].ID==selectID&&j!=0){
                                        $(".shortcut-up").css("background-color","#496083");
                                    }
                                    if(sortshortcut[j].ID==selectID&&j!=sortshortcut.length-1){
                                        $(".shortcut-down").css("background-color","#496083");
                                    }  
                                }
                               
                            });
                            // 删除
                            _liremove.click(sdata[i].ID,function (udata) {

                                $.ajax({
                                    url: "/PortalLTE/Main/DeleteShortCut?ID=" +udata.data,
                                    type: "get",
                                    dataType: "json",
                                    success: function () {
                                        loadShortCut(mainDom,"edit")
                                    },
                                    error: function (xhr, textStatus, errorThrown) {
                                        alert(xhr.responseText);
                                    }
                                });
                            })
                           
                            //点击事件，右侧弹出页面
                            _shtml.click(sdata[i].Url,function (udata) {
                                $("#shortCutUl").find('li.active').removeClass('active');
                                $(this).addClass('active');
                                $(".rightshorcut").remove();
                                url=GetTokenUrl(udata.data);
                                //弹出页面增加右上角关闭
                                var _rhtml=$("<div class='rightshorcut' style='border-radius: 5px;padding: 10px;background-color:white;margin:15px;z-index:10;position: fixed;top:51px;float: left;height: 100vh;'><iframe id='rightUrlIframe' style='height:100%;width:100%;border:0px' src='"+url+"'></iframe></div>");

                                var deleteicon=$("<div class='shortcut-close'></div>");

                                deleteicon.click(function () {
                                    _rhtml.animate({ "left": 200-mainDomwidth+"px" }, '300');
                                    $(this).animate({ "left": 200-mainDomwidth+"px" }, '300');
                                    setTimeout(function(){
                                        $(this).remove();
                                        $(".rightshorcut").remove();
                                        $("#shortCutUl").find('li.active').removeClass('active');
                                        
                                    },300)
                                  
                                });
                                _rhtml.append(deleteicon);
                                mainDomwidth=mainDom[0].clientWidth-280;

                                var mainDomheight=$(".leftShortCut")[0].clientHeight-66;
                                _rhtml.height(mainDomheight);
                               
                                deleteicon.css("left",250+"px").animate({ "left":(250+mainDomwidth) +'px' }, '300');
                                _rhtml.css("left",250-mainDomwidth+"px").animate({ "left": '250px' }, '300');
                                _rhtml.width(mainDomwidth);
                                mainDom.append(_rhtml);

                            });
                            $("#shortCutUl").append(_shtml);
                            $("#shortCutUl").append(_sehtml);
                            switch(type){
                                case "edit":
                                    $(".returnurl").css("display","none");
                                    $(".returnedit").css("display","block");
                                    $(".shortcut-icon").css("display","block");
                                    $(".shortcut-del").css("display","block");
                                    break;
                                case "sort":
                                    $(".returnurl").css("display","none");
                                    $(".returnedit").css("display","block");   
                                    $(".shortcut-sortin").css("display","block");  
                                    if(sdata[i].ID==selectID){
                                        if(i==0){
                                            $(".shortcut-up").css("background-color","#cccccc");
                                        }else{
                                            $(".shortcut-up").css("background-color","#496083");
                                        }
                                       
                                    }
                                    if(sdata[i].ID==selectID&&i!=sdata.length){
                                        if(i==sdata.length-1){                                           
                                            $(".shortcut-down").css("background-color","#cccccc"); 
                                        }else{
                                            $(".shortcut-down").css("background-color","#496083");
                                        }
                                    }  
                                    break;
                                default:
                                    break;
                            }
                        }

                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    alert(xhr.responseText);
                }
            });
        }
        $.ajax({
            url: "/PortalLTE/Main/GetUser",
            type: "get",
            dataType: "json",
            success: function (data) {
                //增加新版报错分支
                if (data.errcode) {
                    return;
                }
                data = JSON.parse(data);
                if (data.length > 0) {
                    data = data[0];
                    $(".widget-user-username").html(data.UserName);
                    $(".widget-user-desc").html(data.WorkNo);
                    for (var key in data) {
                        if (key == 'LastLoginTime') {
                            var date = new Date(data[key]);
                            var year = date.getFullYear();
                            var month = date.getMonth() + 1;
                            var day = date.getDate();
                            month = month < 10 ? "0" + month : month;
                            day = day < 10 ? "0" + day : day;
                            var hour = date.getHours();
                            var minute = date.getMinutes();
                            if (minute < 10)
                                minute = "0" + minute;
                            if (isNaN(year))
                                data[key] = data[key];
                            else
                                data[key] = year + "年" + month + "月" + day + "日 " + hour + ":" + minute;
                        }
                    }
                    var userInfo = data;
                    if (mainDom) {
                        var htmltext = '<div  class="leftShortCut" style="z-index:99;position: fixed;top:20px;left:-250;float: left; width: 250px; height: 100vh;  overflow: auto;  padding-top:30px;overflow-x:hidden;">';
                        htmltext += '<div class="userinfo" style="height:80px;">';
                        htmltext += '<div class="userinfo_left" style="margin:0;padding:0;background:none;height:80px;width:250px">';
                        htmltext += '<div style="text-align: right;width: 80px;height: 80px;float: left;line-height: 80px;">';
                        htmltext += '<img class="img-circle" style="height:50px;width:50px" src="/PortalLTE/Main/UserImage" alt="头像" />';
                        htmltext += '</div>';
                        htmltext += '<div class="userinfo_username_jobname">';
                        htmltext += ' <div class="userinfo_msg" style="width:142px;padding-top:0px">';
                        htmltext += '<div style="color: #ffd400;margin-top: 19px;font-size: 16px;padding-left:15px;height: 23px;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;">' + userInfo.UserName + '</div>';
                        htmltext += '<div style="height: 30px;overflow: hidden;padding-left:15px;white-space: nowrap;text-overflow: ellipsis;">' + userInfo.UserOrgName + '</div>';
                        htmltext += '</div>';
                        htmltext += '</div></div></div>';
                        htmltext += '<div> <ul id="shortCutUl" class="sidebar-menu"  style=" list-style: none;margin: 0;padding: 0; padding-bottom:60px;" data-widget="tree">';
                        htmltext += ' </ul> </div>';
                        var edit = $('<div id="editshortcut" class="shortcut-edit" ></div>');
                        var order = $('<div id="ordershortcut" class="shortcut-sort" ></div>');
                        var reback = $('<div id="reback" class="shortcut-cannel" ></div>');
                        var shortcutup = $('<div  class="shortcut-up" ></div>');
                        var shortcutdown = $('<div  class="shortcut-down" ></div>');
                        var shortcutmincannel = $('<div  class="shortcut-mincannel" ></div>');

                        htmltext += ' </div>';
                        $(".leftShortCut").remove();
                        var _html=$(htmltext);
                        _html.append(edit);
                        _html.append(order);
                        loadShortCut(mainDom,"main")
                        // 排序上升
                        shortcutup.click(function () {
                            for(var j=0;j<sortshortcut.length;j++){
                                if(sortshortcut[j].ID==selectID&&j!=0){
                                    sortshortcut[j-1].sortindex=sortshortcut[j].sortindex;
                                    sortshortcut[j].sortindex=sortshortcut[j].sortindex-1;
                                }
                                if(sortshortcut[j].ID==selectID&&j<=1){
                                    $(".shortcut-up").css("background-color","#cccccc");
                                } 
                            }

                            $.ajax({
                                url: "/PortalLTE/Main/SortShortCut",
                                type: "get",
                                data: { shortcuts: JSON.stringify(sortshortcut) },
                                dataType: "json",
                                success: function () {
                                    loadShortCut(mainDom,"sort")
                                },
                                error: function (xhr, textStatus, errorThrown) {
                                    alert(xhr.responseText);
                                }
                            });
                        })
                        // 排序下降
                        shortcutdown.click(function () {
                            for(var j=0;j<sortshortcut.length;j++){
                                if(sortshortcut[j].ID==selectID&&j!=(sortshortcut.length-1)){
                                    sortshortcut[j+1].sortindex=sortshortcut[j].sortindex;
                                    sortshortcut[j].sortindex=sortshortcut[j].sortindex-(-1);
                                }
                                if(sortshortcut[j].ID==selectID&&j>=(sortshortcut.length-2)){
                                    $(".shortcut-down").css("background-color","#cccccc");
                                } 
                            }
                            $.ajax({
                                url: "/PortalLTE/Main/SortShortCut",
                                type: "get",
                                data: { shortcuts: JSON.stringify(sortshortcut) },
                                dataType: "json",
                                success: function () {
                                    loadShortCut(mainDom,"sort")
                                },
                                error: function (xhr, textStatus, errorThrown) {
                                    alert(xhr.responseText);
                                }
                            });
                        })
                        settype="main";
                        edit.click(function () {
                            settype="edit";
                            $("#editshortcut").remove();
                            $("#ordershortcut").remove();
                            $("#shortCutUl").removeClass("sidebar-menu");
                            $(".leftShortCut").append(reback);
                            $(".returnurl").css("display","none");
                            $(".returnedit").css("display","block");
                            $(".shortcut-icon").css("display","block");
                            $(".shortcut-del").css("display","block");

                        });
                        order.click(function () {
                            settype="sort";
                            $("#editshortcut").remove();
                            $("#ordershortcut").remove();
                            $("#shortCutUl").removeClass("sidebar-menu");
                            $(".leftShortCut").append(shortcutup);
                            $(".leftShortCut").append(shortcutdown);
                            $(".leftShortCut").append(shortcutmincannel);
                            $(".returnurl").css("display","none");
                            $(".returnedit").css("display","block");   
                            $(".shortcut-sortin").css("display","block");   
                                                    
                        });
                        reback.click(function () {
                            settype="main";
                            bindLeftShortCut(mainDom, topDom,logoDom);
                        });
                        shortcutmincannel.click(function () {
                            settype="main";
                            bindLeftShortCut(mainDom, topDom,logoDom);
                        });
                        
                        if (logoDom&&typeof(logoDom.css('marginLeft'))!="undefined"&&logoDom.css('marginLeft').indexOf("-")==0) {
                            mainDom.css("padding-left", '0px');
                            _html.css("left", '-250px');
                            edit.css("left", '-250px');
                            order.css("left", '-125px');
                            reback.css("left", '-250px');
                        } else {
                            mainDom.css("padding-left", '250px');
                            _html.css("left", '0px');
                            edit.css("left", '0px');
                            order.css("left", '125px');
                            reback.css("left", '0px');
                        }
                        mainDom.prepend(_html);
                        if (topDom && logoDom) {
                            topDom.click(function () {                            
                                if (logoDom&&typeof(logoDom.css('marginLeft'))!="undefined"&&logoDom.css('marginLeft').indexOf("-")==0) {
                                    mainDom.animate({ "padding-left": '0px' }, '300');
                                    _html.animate({ "left": '-250px' }, '300');
                                    edit.animate({ "left": '-250px' }, '300');
                                    order.animate({ "left": '-125px' }, '300');
                                    reback.animate({ "left": '-250px' }, '300');
                                    if($(".rightshorcut")){
                                        $(".rightshorcut").css("width",(mainDomwidth+250)+"px" ).animate({ "left": '0px' }, '300');
                                    }
                                  
                                } else {
                                    mainDom.animate({ "padding-left": '250px' }, '300');
                                    _html.animate({ "left": '0px' }, '300');                                   
                                    edit.animate({ "left": '0px' }, '300');
                                    order.animate({ "left": '125px' }, '300');
                                    reback.animate({ "left": '0px' }, '300');
                                    if($(".rightshorcut")){
                                        $(".rightshorcut").animate({ "left": '250px' },300);
                                        setTimeout(function(){
                                            $(".rightshorcut").css("width",mainDomwidth+"px" );
                                        },300);
                                    }
                                }
                            });
                            logoDom.click(function () {
                               
                                loadShortCut(mainDom,settype);                          
                                if (logoDom&&typeof(logoDom.css('marginLeft'))!="undefined"&&logoDom.css('marginLeft').indexOf("-")==0) {
                                    mainDom.css("padding-left", '0px');                                 
                                    _html.css("left", '-250px');
                                    edit.css("left", '-250px');
                                    order.css("left", '-125px');
                                    reback.css("left", '-250px');
                                   
                                } else {
                                    mainDom.css("padding-left", '250px');
                                    _html.css("left", '0px');
                                    edit.css("left", '0px');
                                    order.css("left", '125px');
                                    reback.css("left", '0px');
                                    if($(".rightshorcut")){
                                        $(".rightshorcut").css("width",mainDomwidth+"px" ).css("left", '250px');
                                    }
                                }
                            });
                        }

                    }
                }
            },
            error: function (xhr, textStatus, errorThrown) {  
                alert(xhr.responseText);
            }
        });

    }
    //-------------------------增加门户左侧快捷方式结束----------------------------------//
  
    var leftshortcut= "@Html.Raw(ViewBag.IsUseLeftShortCut)"; 
    if (userInfo != ''){
        if(leftshortcut!=undefined&&leftshortcut!=null&&leftshortcut=="True"){
         
            bindLeftShortCut($("#index-main-list"),$("#sidebar-toggle"),$(".logo"));
        }
    }

    //判断是否跨域，如果跨域则带上token
    function GetTokenUrl(url){
        if(url.indexOf("http")>=0){
            var domain = url.split('/'); //以“/”进行分割
            var returnurl="";
            if( domain[2] ) {
                returnurl = domain[0]+"//"+domain[2];
            } else {
                returnurl = ''; //如果url不正确就取空
            }
           
            var urlflag=false;           
            var lourl= path = "http://"+document.location.host; 
            if(returnurl.indexOf(":")){               
                if(returnurl.indexOf(lourl)<0){
                    urlflag=true;
                }
            }else{
                lourl=lourl.substr(0, lourl.indexOf(':'));
                if(document.location.port!="80"||returnurl.indexOf(lourl)<0){
                    urlflag=true;
                }
            }
            if(urlflag){
                var tokens= GetToken();
                if (typeof (tokens) != "undefined" &&typeof (tokens.Token) != "undefined" && typeof (tokens.TokenKey) != "undefined" && tokens.TokenKey && tokens.Token) {
                    if (url.indexOf(tokens.TokenKey + "=") < 0) {
                        if (url.indexOf("?") > 0) {
                            url += "&" + tokens.TokenKey + "=" + tokens.Token;
                        }
                        else {
                            url += "?" + tokens.TokenKey + "=" + tokens.Token;
                        }
                    }
                }
            }
        }
        return url;
    }
    //获取token
    function GetToken(){
        var data;
        $.ajax({
            url: "/PortalLTE/Main/GetToken",
            type: "get",
            dataType: "json",
            async: false,
            success: function (sdata) {
                data= sdata;
            }
        });
        return data;
    }

    //--------------导航地图开始-----------------------
    function navigationbar(){
        if($(".navshorcut").length<=0){
            var url="/PortalLTE/Main/Navigition"
            var _navhtml=$("<div class='navshorcut' style='border-radius: 5px;background-color:rgba(0, 0, 0, 0.44);z-index:1000;position: fixed;top:-1051px;left:0;height: 100vh;'><iframe id='navUrlIframe' style='margin-top: 50px;height:80%;width:100%;border:0px;box-shadow: 0px 0px 5px #000000;background-color:#ffffff' src='"+url+"'></iframe></div>");
            var deleteicon=$("<div id='navshorcut-close' class='navshorcut-close' style='top:-1051px;right:20px' ></div>");
       
            var mainDomwidth=document.body.clientWidth;
            var mainDomheight=document.body.clientHeight;
            deleteicon.click(function () {           
                var mainDomheightd=document.body.clientHeight;
                _navhtml.animate({ "top":-mainDomheightd-100+"px" }, '200');
                $(this).animate({ "top": -mainDomheightd-100+"px" }, '200');
           
            });
            _navhtml.click(function () { 
                var mainDomheightd=document.body.clientHeight;
                _navhtml.animate({ "top":-mainDomheightd-100+"px" }, '200');
                $(this).animate({ "top": -mainDomheightd-100+"px" }, '200');           
            });
            _navhtml.append(deleteicon);
            $("#newPortal").append(_navhtml);
        }               
        $(".navshorcut").height(mainDomheight);  
       
        $(".navshorcut").width(mainDomwidth);
        $("#navUrlIframe").height(mainDomheight*0.9);  
        $("#navUrlIframe").width(mainDomwidth);
        $(".navshorcut-close").animate({ "top": '72px' },200);
        $("#navUrlIframe").animate({ "top": '0px' },200);
        $(".navshorcut").animate({ "top": '0px' },200);

        $(window).resize(function () {
            if($("#newPortal")[0]&&$(".navshorcut")){
                var mainDomwidth=document.body.clientWidth;
                var mainDomheight=document.body.clientHeight;
                $("#navUrlIframe").height(mainDomheight*0.9);  
                $("#navUrlIframe").width(mainDomwidth);
                $(".navshorcut").height(mainDomheight);  
                $(".navshorcut-close").css("left",mainDomwidth-50+"px");  
                $(".navshorcut").width(mainDomwidth);          
            }          
        });
    }
    function goNavUrl(name,url,ele) {
        if(ele.lastChild.className.indexOf('nosearch')<0){
            if (url) {
                url=GetTokenUrl(url);
                var mainDomwidth=document.body.clientWidth;
                var mainDomheight=document.documentElement.clientHeight;
                var titleheight=-1051-document.body.clientHeight+"px";
                var mainDomheightd=document.body.clientHeight;
                $(".navshorcut").animate({ "top":-mainDomheightd-100+"px" }, '500');
                $(".navshorcut-close").animate({ "top": -mainDomheightd-100+"px" }, '500');    
                var _navhtml=$("<div class='pageview' style='z-index:999;position: fixed;top:-1051px;background-color:rgba(0, 0, 0, 0.44);float: left;'><iframe id='navpageUrlIframe' style='margin-top: 90px;height:100%;width:100%;border:0px;background:#ffffff;overflow:auto;padding-bottom:50px;' src='"+url+"'></iframe></div>");
                var deleteicons=$("<div class='pageclose' style='top:"+titleheight+";right:10px' ></div>");
                var htmltitle=$("<div id='navhtmltitle' style='top:"+titleheight+";position:fixed;height: 40px;line-height: 40px;font-size: 16px; padding-left: 10px;width: 100%;background: white;border-bottom: 1px solid #d2d2d2;' >"+name+"</div>");
              
                deleteicons.click(function () {
                    var mainDomheightd=document.getElementById("newPortal").clientHeight;                                   
                    $("#navhtmltitle").animate({ "top":-mainDomheightd-500+"px" }, 300);
                    $(".pageview").animate({ "top":-mainDomheightd-500+"px" }, 300);
                    $(this).animate({ "top": -mainDomheightd-500+"px" }, 300);                      
                    setTimeout(function(){                            
                        $(this).remove();
                        $(".pageview").remove();
                    },400)
                });
                htmltitle.append(deleteicons);
                _navhtml.append(htmltitle);
                $("#newPortal").append(_navhtml);
                $(".pageview").height(mainDomheight);
                $(".pageview").width(mainDomwidth);
                deleteicons.animate({ "top": '55px' },200);
                _navhtml.animate({ "top": '0px' },200);
                htmltitle.animate({ "top": '50px' },200);
                $(window).resize(function () {
                    if($(".pageview")){
                        var mainDomwidth=document.body.clientWidth;
                        var mainDomheight=document.documentElement.clientHeight
                        $(".pageview").height(mainDomheight);  
                        $(".pageclose").css("left",mainDomwidth-50+"px");  
                        $(".pageview").width(mainDomwidth);
                    }          
                });                    
            }
            else
                return;
        }
    }
    //--------------导航地图结束-----------------------
</script>

</body>
</html>
